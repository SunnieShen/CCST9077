<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width,initial-scale=1.0">
      <title>CHSH Quantum Game-Enhanced</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	  <!-- style settings -->
      <style>
		*{ margin: 0; padding: 0; box-sizing: border-box; font-family: 'SegoeUI',Tahoma,Geneva,Verdana,sans-serif; } body{ background: linear-gradient(135deg,#0c2461,#1e3799);
		color: #fff; min-height: 100vh; padding: 20px; } .container{ max-width:
		1000px; margin: 0 auto; } header{ text-align: center; margin-bottom: 20px;
		padding: 15px; } h1{ font-size: 2.2rem; margin-bottom: 10px; background:
		linear-gradient(to right,#ff9a9e,#fad0c4); -webkit-background-clip: text;
		background-clip: text; color: transparent; } .subtitle{ font-size: 1rem;
		opacity: 0.9; max-width: 800px; margin: 0 auto; line-height: 1.5; } .mode-selector{
		display: flex; margin-bottom: 20px; border-radius: 12px; overflow: hidden;
		background: rgba(0,0,0,0.2); position: relative; } .mode-btn{ flex: 1;
		padding: 12px; text-align: center; cursor: pointer; transition: all 0.3s
		ease; font-weight: bold; font-size: 0.9rem; } .mode-btn.active{background:
		rgba(106,17,203,0.7);} .mode-btn:hover{background: rgba(255,255,255,0.1);}
		.game-area{ display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;
		} .players-container{ flex: 1; min-width: 300px; background: rgba(255,255,255,0.08);
		border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		} .player{margin-bottom: 25px;} .player:last-child{margin-bottom: 0;} .player-title{
		font-size: 1.3rem; margin-bottom: 15px; display: flex; align-items: center;
		color: #ffdd59; } .player-title i{ margin-right: 10px; } .question-box,.answer-box{
		background: rgba(0,0,0,0.2); padding: 12px; border-radius: 10px; margin-bottom:
		12px; } .box-title{ font-size: 0.9rem; margin-bottom: 8px; color: #81ecec;
		display: flex; align-items: center; } .box-title i{margin-right: 8px;}
		.box-value{ font-size: 1.8rem; text-align: center; font-weight: bold; height:
		45px; display: flex; align-items: center; justify-content: center; } .vis-container{
		flex: 1; min-width: 300px; background: rgba(255,255,255,0.08); border-radius:
		15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); } .vis-title{
		font-size: 1.3rem; margin-bottom: 15px; display: flex; align-items: center;
		color: #ffdd59; } .vis-title i{margin-right: 10px;} .vis-area{ position:
		relative; height: 200px; margin: 15px 0; overflow: hidden; border-radius:
		10px; background: rgba(0,0,0,0.2); } .entanglement-container{ position:
		absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items:
		center; justify-content: center; opacity: 0; transition: opacity 0.5s ease;
		} .entanglement-container.active{opacity: 1;} .entanglement-line{ position:
		absolute; width: 100%; height: 3px; background: linear-gradient(to right,transparent,#ff6b6b,#4ecdc4,transparent);
		z-index: 1; border-radius: 2px; } .photon{ width: 40px; height: 40px; border-radius:
		50%; position: absolute; z-index: 2; display: flex; align-items: center;
		justify-content: center; font-size: 1.2rem; box-shadow: 0 0 15px rgba(255,255,255,0.5);
		transition: all 0.5s ease; } .photon-alice{ background: radial-gradient(circle
		at 30% 30%,#ff6b6b,#c44569); left: 20%; } .photon-bob{ background: radial-gradient(circle
		at 30% 30%,#4ecdc4,#1e824c); right: 20%; } .measurement-process{ position:
		absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); background:
		rgba(0,0,0,0.6); padding: 10px 15px; border-radius: 8px; font-size: 0.9rem;
		text-align: center; color: #ffdd59; z-index: 3; opacity: 0; transition:
		opacity 0.5s ease; } .measurement-process.show{opacity: 1;} .classic-vis{
		position: absolute; top: 0; left: 0; width: 100%; height: 100%; text-align:
		center; display: flex; flex-direction: column; justify-content: center;
		align-items: center; opacity: 0; transition: opacity 0.5s ease; padding:
		20px; } .classic-vis.active{opacity: 1;} .classic-icon{ font-size: 3rem;
		margin-bottom: 15px; color: #3498db; } .game-controls{ display: flex; flex-wrap:
		wrap; gap: 10px; margin: 15px 0; } .btn{ padding: 10px 15px; border: none;
		border-radius: 8px; font-weight: bold; cursor: pointer; transition: all
		0.3s ease; font-size: 0.95rem; display: flex; align-items: center; justify-content:
		center; flex: 1; min-width: 120px; } .btn i{margin-right: 8px;} .btn-primary{
		background: linear-gradient(to right,#6a11cb,#2575fc); color: white; }
		.btn-secondary{ background: rgba(255,255,255,0.1); color: white; border:
		1px solid rgba(255,255,255,0.3); } .btn-tertiary{ background: linear-gradient(to
		right,#9c27b0,#673ab7); color: white; } .btn:disabled{ opacity: 0.5; cursor:
		not-allowed; } .game-res{ text-align: center; padding: 15px; border-radius:
		10px; margin-top: 15px; font-size: 1rem; opacity: 0; height: 0; overflow:
		hidden; transition: all 0.5s ease; } .game-res.show{ opacity: 1; height:
		auto; } .res-win{ background: rgba(46,204,113,0.2); border: 1px solid #2ecc71;
		color: #2ecc71; } .res-lose{ background: rgba(231,76,60,0.2); border: 1px
		solid #e74c3c; color: #e74c3c; } .batch-progress{ margin-top: 15px; background:
		rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; display: none; } .batch-progress.active{
		display: block; } .progress-bar{ height: 20px; background: rgba(255,255,255,0.1);
		border-radius: 10px; overflow: hidden; margin: 10px 0; } .progress-fill{
		height: 100%; background: linear-gradient(to right,#00b09b,#96c93d); width:
		0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content:
		center; font-size: 0.8rem; color: white; font-weight: bold; } .progress-text{
		font-size: 0.9rem; text-align: center; margin-bottom: 10px; color: #81ecec;
		} .batch-results{ margin-top: 15px; display: grid; grid-template-columns:
		repeat(2, 1fr); gap: 10px; } .batch-result-item{ background: rgba(0,0,0,0.2);
		padding: 10px; border-radius: 8px; text-align: center; } .batch-result-value{
		font-size: 1.5rem; font-weight: bold; color: #ffdd59; } .batch-result-label{
		font-size: 0.8rem; opacity: 0.9; } .info-panel{ background: rgba(255,255,255,0.08);
		border-radius: 15px; padding: 20px; margin-top: 20px; box-shadow: 0 5px
		15px rgba(0,0,0,0.2); } .panel-title{ font-size: 1.3rem; margin-bottom:
		15px; display: flex; align-items: center; color: #ffdd59; } .panel-title
		i{margin-right: 10px;} .stats{ display: flex; flex-wrap: wrap; gap: 15px;
		margin-bottom: 20px; } .stat-box{ flex: 1; min-width: 150px; background:
		rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; text-align: center;
		} .stat-value{ font-size: 2rem; font-weight: bold; margin: 5px 0; color:
		#81ecec; } .stat-label{ font-size: 0.9rem; opacity: 0.9; } .rules{ background:
		rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 15px;
		font-size: 0.9rem; } .rules h3{ margin-bottom: 10px; color: #81ecec; }
		.rules ul{ padding-left: 20px; line-height: 1.5; } .rules li{margin-bottom:
		8px;} .win-condition{ color: #2ecc71; font-weight: bold; } .quantum-advantage{color:
		#ffdd59;} @media(max-width: 768px){ .game-area{ flex-direction: column;
		} h1{font-size: 1.8rem;} .subtitle{font-size: 0.9rem;} .mode-btn{ font-size:
		0.8rem; padding: 10px 5px; } .players-container,.vis-container{min-width:
		100%;} .vis-area{height: 160px;} .photon-alice{left: 15%;} .photon-bob{right:
		15%;} .stat-box{min-width: calc(50%-10px);} .btn{min-width: calc(50%-5px);}
		.batch-results{ grid-template-columns: 1fr; } } @media(max-width: 480px){
		body{padding: 10px;} .container{padding: 5px;} .players-container,.vis-container,.info-panel{padding:
		15px;} .stat-box{min-width: 100%;} .btn{min-width: 100%;} .mode-selector{flex-direction:
		column;} .mode-btn{padding: 12px;} }
		</style>
   </head>
   <body>
      <div class="container">
         <div class="mode-selector">
            <div class="mode-btn active" id="mode-random">Classical Random</div>
            <div class="mode-btn" id="mode-agreed">Classical Agreed</div>
            <div class="mode-btn" id="mode-quantum">Quantum Strategy</div>
         </div>
         <div class="game-area">
            <div class="players-container">
               <div class="player">
                  <h2 class="player-title"> Alice</h2>
                  <div class="question-box">
                     <div class="box-title"><i class="fas fa-question-circle"></i> Question(x)</div>
                     <div class="box-value" id="alice-question">?</div>
                  </div>
                  <div class="answer-box">
                     <div class="box-title"><i class="fas fa-lightbulb"></i> Answer(a)</div>
                     <div class="box-value" id="alice-answer">?</div>
                  </div>
               </div>
               <div class="player">
                  <h2 class="player-title"> Bob</h2>
                  <div class="question-box">
                     <div class="box-title"><i class="fas fa-question-circle"></i> Question(y)</div>
                     <div class="box-value" id="bob-question">?</div>
                  </div>
                  <div class="answer-box">
                     <div class="box-title"><i class="fas fa-lightbulb"></i> Answer(b)</div>
                     <div class="box-value" id="bob-answer">?</div>
                  </div>
               </div>
            </div>
            <div class="vis-container">
               <h2 class="vis-title"><i class="fas fa-eye"></i> <span id="vis-title">Strategy Visualization</span></h2>
               <div class="vis-area">
                  <div class="classic-vis active" id="classic-vis">
                     <div class="classic-icon">
                        <i class="fas fa-users-slash"></i>
                     </div>
                     <div class="classic-text" id="classic-text">
                        Classical Strategy: Alice and Bob answer independently
                     </div>
                  </div>
                  <div class="entanglement-container" id="quantum-vis">
                     <div class="entanglement-line"></div>
                     <div class="measurement-process" id="measurement-process">
                        Entangled particle pair ready
                     </div>
                     <div class="photon photon-alice" id="photon-alice">
                        <i class="fas fa-bolt"></i>
                     </div>
                     <div class="photon photon-bob" id="photon-bob">
                        <i class="fas fa-bolt"></i>
                     </div>
                  </div>
               </div>
               <div class="game-controls">
                  <button class="btn btn-primary" id="btn-start">
                  <i class="fas fa-play"></i> Start Demo
                  </button>
                  <button class="btn btn-secondary" id="btn-stop">
                  <i class="fas fa-stop"></i> Stop Demo
                  </button>
                  <button class="btn btn-secondary" id="btn-reset">
                  <i class="fas fa-redo"></i> Reset
                  </button>
                  <button class="btn btn-tertiary" id="btn-1000">
                  <i class="fas fa-forward"></i> Run 1000 Rounds
                  </button>
               </div>
               <div class="batch-progress" id="batch-progress">
                  <div class="progress-text" id="batch-status">Running 1000 rounds...</div>
                  <div class="progress-bar">
                     <div class="progress-fill" id="progress-fill">0%</div>
                  </div>
                  <div class="batch-results">
                     <div class="batch-result-item">
                        <div class="batch-result-value" id="batch-wins">0</div>
                        <div class="batch-result-label">Wins</div>
                     </div>
                     <div class="batch-result-item">
                        <div class="batch-result-value" id="batch-rounds">0</div>
                        <div class="batch-result-label">Rounds</div>
                     </div>
                     <div class="batch-result-item">
                        <div class="batch-result-value" id="batch-win-rate">0%</div>
                        <div class="batch-result-label">Win Rate</div>
                     </div>
                     <div class="batch-result-item">
                        <div class="batch-result-value" id="batch-quantum-advantage">0%</div>
                        <div class="batch-result-label">Quantum Advantage</div>
                     </div>
                  </div>
               </div>
               <div class="game-res" id="game-res"></div>
            </div>
         </div>
         <div class="info-panel">
            <h2 class="panel-title"><i class="fas fa-chart-bar"></i> Game Statistics</h2>
            <div class="stats">
               <div class="stat-box">
                  <div class="stat-label">Rounds Played</div>
                  <div class="stat-value" id="rounds-count">0</div>
               </div>
               <div class="stat-box">
                  <div class="stat-label">Wins</div>
                  <div class="stat-value" id="wins-count">0</div>
               </div>
               <div class="stat-box">
                  <div class="stat-label">Win Rate</div>
                  <div class="stat-value" id="win-rate">0%</div>
               </div>
               <div class="stat-box">
                  <div class="stat-label">Theoretical Rate</div>
                  <div class="stat-value" id="theo-Win-Rate">50%</div>
               </div>
            </div>
         </div>
      </div>
      <script>
         const game={
         	mode: 'random',
         	rounds: 0,
         	wins: 0,
         	current:{
         		x: null,y: null,a: null,b: null,res: null,aliceDirection: null,bobDirection: null},
         	isPlaying: false,
         	playInterval: null,
         	isRunningBatch: false
         };
         const aliceQEl=document.getElementById('alice-question'),aliceAEl=document.getElementById('alice-answer');
         const bobQEl=document.getElementById('bob-question'),bobAEl=document.getElementById('bob-answer');
         const gameResultEl=document.getElementById('game-res');
         const roundsCountEl=document.getElementById('rounds-count');
         const winsCountEl=document.getElementById('wins-count');
         const winRateEl=document.getElementById('win-rate');
         const theoWinRate=document.getElementById('theo-Win-Rate');
         const clVisEl=document.getElementById('classic-vis'),quVisEl=document.getElementById('quantum-vis');
         const visTitleEl=document.getElementById('vis-title');
         const classicTextEl=document.getElementById('classic-text');
         const photonAliceEl=document.getElementById('photon-alice'),photonBobEl=document.getElementById('photon-bob');
         const measurementProcessEl=document.getElementById('measurement-process');
         const startBtn=document.getElementById('btn-start');
         const stopBtn=document.getElementById('btn-stop');
         const resetBtn=document.getElementById('btn-reset');
         const run1000Btn=document.getElementById('btn-1000');
         const modeRandomBtn=document.getElementById('mode-random');
         const modeAgreedBtn=document.getElementById('mode-agreed');
         const modeQuantumBtn=document.getElementById('mode-quantum');
         const batchProgressEl=document.getElementById('batch-progress');
         const batchStatusEl=document.getElementById('batch-status');
         const progressFillEl=document.getElementById('progress-fill');
         const batchWinsEl=document.getElementById('batch-wins');
         const batchRoundsEl=document.getElementById('batch-rounds');
         const batchWinRateEl=document.getElementById('batch-win-rate');
         const batchQuantumAdvantageEl=document.getElementById('batch-quantum-advantage');
         function initGame(){
         	resetRound();
         	updateStatsDisp();
         	updateModeDisp();
         	startBtn.addEventListener('click',startDemo);
         	stopBtn.addEventListener('click',stopDemo);
         	resetBtn.addEventListener('click',resetGame);
         	run1000Btn.addEventListener('click',runBatch1000);
         	modeRandomBtn.addEventListener('click',()=>switchMode('random'));
         	modeAgreedBtn.addEventListener('click',()=>switchMode('agreed'));
         	modeQuantumBtn.addEventListener('click',()=>switchMode('quantum'));
         	stopBtn.disabled=true;
         }
         function switchMode(mode){
         	game.mode=mode;
         	modeRandomBtn.classList.toggle('active',mode==='random');
         	modeAgreedBtn.classList.toggle('active',mode==='agreed');
         	modeQuantumBtn.classList.toggle('active',mode==='quantum');
         	updateModeDisp();
         	resetGame();
         }
         function updateModeDisp(){
         	if(game.mode==='random'){
         		theoWinRate.textContent='50%';				
         		visTitleEl.textContent='Classical Strategy Visualization';
         		classicTextEl.textContent='Classical Strategy: Alice and Bob answer independently';				
         		clVisEl.classList.add('active');
         		quVisEl.classList.remove('active');				
         	}
         	else if(game.mode==='agreed'){
         		theoWinRate.textContent='75%';				
         		visTitleEl.textContent='Classical Strategy Visualization';
         		classicTextEl.textContent='Classical Agreed: Alice and Bob pre-agree on answers';				
         		clVisEl.classList.add('active');
         		quVisEl.classList.remove('active');				
         	}
         	else{
         		theoWinRate.textContent='≈85%';				
         		visTitleEl.textContent='Quantum Entanglement Visualization';				
         		clVisEl.classList.remove('active');
         		quVisEl.classList.add('active');				
         		resetQuantumVis();
         	}
         }
         function resetQuantumVis(){
         	measurementProcessEl.textContent='Entangled particle pair ready';
         	measurementProcessEl.classList.add('show');   
         	photonAliceEl.style.transform='scale(1)';
         	photonAliceEl.style.boxShadow='0 0 15px rgba(255,255,255,0.5)';
         	photonBobEl.style.transform='scale(1)';
         	photonBobEl.style.boxShadow='0 0 15px rgba(255,255,255,0.5)';
         }
         function startDemo(){
         	game.isPlaying=true;
         	startBtn.disabled=true;
         	stopBtn.disabled=false;
         	run1000Btn.disabled=true;
         	playRound();   
         	game.playInterval=setInterval(playRound,3000);
         }
         function stopDemo(){
         	game.isPlaying=false;
         	clearInterval(game.playInterval);
         	startBtn.disabled=false;
         	stopBtn.disabled=true;
         	if(game.mode==='quantum'){
         		run1000Btn.disabled=false;
         	}
         }
         function playRound(){
         	resetRound();
         	game.current.x=Math.random()<0.5?0:1;
         	game.current.y=Math.random()<0.5?0:1;
         	updateQDisp();
         	if(game.mode==='quantum'){showMeasurementProcess();}
         	else{setTimeout(()=>{generateAnswers();},300);}
         }
         function showMeasurementProcess(){
         	measurementProcessEl.textContent='Selecting measurement direction based on questions...';
         	setTimeout(()=>{
         		const aliceDir=game.current.x===0?'0°/90° direction':'45°/-45° direction';
         		const bobDir=game.current.y===0?'22.5°/112.5° direction':'67.5°/-22.5° direction';
         		game.current.aliceDirection=aliceDir;
         		game.current.bobDirection=bobDir;
         		measurementProcessEl.textContent='Measuring...';
         		photonAliceEl.style.transform='scale(1.3)';
         		photonAliceEl.style.boxShadow='0 0 25px rgba(255,255,255,0.8)';
         		photonBobEl.style.transform='scale(1.3)';
         		photonBobEl.style.boxShadow='0 0 25px rgba(255,255,255,0.8)';
         		setTimeout(()=>{generateQuantumAnswers();},800);
         	},1200);
         }
         function generateQuantumAnswers(){
         	const{x,y}=game.current;
			//using the calculated result for entanglement
         	const p=(1+(Math.sqrt(2)/2))/2;
         	let a=Math.random()<0.5?0:1,b;
         	if(x===1&&y===1){
         		if(Math.random()<p)b=1-a;
         		else b=a;
         	}
         	else {
         		if(Math.random()<p)b=a;
         		else b=1-a;
         	}
         	game.current.a=a;
         	game.current.b=b;
         	measurementProcessEl.textContent='Measurement complete!';
         	photonAliceEl.style.transform='scale(1)';
         	photonAliceEl.style.boxShadow='0 0 15px rgba(255,255,255,0.5)';
         	photonBobEl.style.transform='scale(1)';
         	photonBobEl.style.boxShadow='0 0 15px rgba(255,255,255,0.5)';
         	updateADisp();
         	setTimeout(()=>{checkRoundResult();},500);
         }
         function generateAnswers(){
         	const{x,y}=game.current;
         	let a,b;
         	if(game.mode==='random'){
         		a=Math.random()<0.5?0:1;
         		b=Math.random()<0.5?0:1;
         	} else if(game.mode==='agreed'){a=0;b=0;}
         	game.current.a=a;
         	game.current.b=b;	
         	updateADisp();
         	setTimeout(()=>{checkRoundResult();},500);
         }
         function updateQDisp(){
         	aliceQEl.textContent=game.current.x;
         	bobQEl.textContent=game.current.y;
         }
         function updateADisp(){
         	aliceAEl.textContent=game.current.a;
         	bobAEl.textContent=game.current.b;
         }
         function checkRoundResult(){
         	const{x,y,a,b}=game.current;
         	const isWin=(a^b)===(x&y);
         	game.current.res=isWin?'win':'lose';
         	game.rounds++;
         	if(isWin)game.wins++;
         	updateStatsDisp();
         	showRoundResult(isWin,(a^b),(x&y));
         }
         function showRoundResult(isWin,aXorB,xAndy){
         	let resText=``;
         	if(isWin){resText+=`<strong>Win!</strong>`;} 
         	else{resText+=`<strong>Lose!</strong>`;}
         	if(game.mode==='agreed' && !isWin){
         		resText+=`Agreed strategy always fails when x=y=1.`;
         	} 
         	else if(game.mode==='quantum'){
         		const{ aliceDirection,bobDirection }=game.current;
         		resText+=`<br><small>Alice measurement: ${aliceDirection}`;
         		resText+=`<br>Bob measurement: ${bobDirection}</small>`;
         	}
         	gameResultEl.innerHTML=resText;
         	gameResultEl.className=`game-res ${isWin?'res-win':'res-lose'} show`;
         	if(game.isPlaying){
         		setTimeout(()=>{
         			if(game.isPlaying){gameResultEl.classList.remove('show');}
         		},4500);
         	}
         }
         function updateStatsDisp(){
         	roundsCountEl.textContent=game.rounds;
         	winsCountEl.textContent=game.wins;
         	const winRate=game.rounds>0?Math.round((game.wins / game.rounds)* 100):0;
         	winRateEl.textContent=`${winRate}%`;
         }
         function resetRound(){
         	game.current={
         		x: null,y: null,a: null,b: null,res: null,aliceDirection: null,bobDirection: null
         	};
         	aliceQEl.textContent='?';aliceAEl.textContent='?';
         	bobQEl.textContent='?';bobAEl.textContent='?';
         	gameResultEl.classList.remove('show');
         }
         function resetGame(){
         	stopDemo();
         	game.rounds=0;
         	game.wins=0;
         	resetRound();
         	updateStatsDisp();
         	if(game.mode==='quantum'){
         		resetQuantumVis();
         		run1000Btn.disabled=false;
         	}
         }
		 // enable batch 1000 rounds
         async function runBatch1000(){
         	if(game.mode !== 'quantum') return;
         	game.isRunningBatch = true;
         	stopDemo();
         	batchProgressEl.classList.add('active');
         	batchStatusEl.textContent = 'Running 1000 quantum rounds...';
         	startBtn.disabled = true;
         	stopBtn.disabled = true;
         	resetBtn.disabled = true;
         	run1000Btn.disabled = true;
         	modeRandomBtn.disabled = true;
         	modeAgreedBtn.disabled = true;
         	modeQuantumBtn.disabled = true;
         	const totalRounds = 1000;
         	let batchWins = 0;
         	let batchRounds = 0;
         	measurementProcessEl.textContent = 'Running 1000 quantum measurements...';
         	measurementProcessEl.classList.add('show');
         	const batchSize = 100;
         	const totalBatches = totalRounds / batchSize;
         	for(let batch = 0; batch < totalBatches; batch++){
         		for(let i = 0; i < batchSize; i++){
         			const x = Math.random()<0.5?0:1;
         			const y = Math.random()<0.5?0:1;
         			const p = (1+(Math.sqrt(2)/2))/2;
         			const a = Math.random()<0.5?0:1;
         			let b;
         			if(x===1 && y===1){
         				b = Math.random()<p ? 1-a : a;
         			} else {
         				b = Math.random()<p ? a : 1-a;
         			}
         			const isWin = (a ^ b) === (x & y);
         			if(isWin) batchWins++;
         			batchRounds++;
         			game.rounds++;
         			if(isWin) game.wins++;
         		}
         		const progress = ((batch + 1) / totalBatches) * 100;
         		progressFillEl.style.width = `${progress}%`;
         		progressFillEl.textContent = `${Math.round(progress)}%`;
         		batchWinsEl.textContent = batchWins;
         		batchRoundsEl.textContent = batchRounds;
         		const batchWinRate = Math.round((batchWins / batchRounds) * 100);
         		batchWinRateEl.textContent = `${batchWinRate}%`;
         		batchQuantumAdvantageEl.textContent = `${batchWinRate - 75}%`;
         		updateStatsDisp();
         		await new Promise(resolve => setTimeout(resolve, 10));
         	}
         	batchStatusEl.textContent = '1000 rounds completed!';
         	batchStatusEl.style.color = '#2ecc71';
         	progressFillEl.style.background = 'linear-gradient(to right,#00b09b,#96c93d)';
         	const finalWinRate = Math.round((batchWins / batchRounds) * 100);
         	const quantumAdvantage = finalWinRate - 75;
         	setTimeout(() => {
         		gameResultEl.innerHTML = `
         			<strong>Batch Results:</strong><br>
         			• ${batchWins} wins out of ${batchRounds} rounds<br>
         			• Win rate: ${finalWinRate}%<br>
         			• Quantum advantage: ${quantumAdvantage}% over classical<br>
         			• Close to theoretical ≈85% quantum win rate!
         		`;
         		gameResultEl.className = 'game-res res-win show';
         	}, 500);
         	startBtn.disabled = false;
         	stopBtn.disabled = true;
         	resetBtn.disabled = false;
         	run1000Btn.disabled = false;
         	modeRandomBtn.disabled = false;
         	modeAgreedBtn.disabled = false;
         	modeQuantumBtn.disabled = false;
         	game.isRunningBatch = false;
         	setTimeout(() => {
         		batchProgressEl.classList.remove('active');
         		resetQuantumVis();
         		gameResultEl.classList.remove('show');
         	}, 5000);
         }
         window.addEventListener('DOMContentLoaded',initGame);
      </script>
   </body>
</html>
